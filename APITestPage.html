<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API TEST SITE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<!--- temporary code to resolve favicon error --->
    <link rel="shortcut icon" href="#">
<style>
  form {
      text-align:center;
  }

  div.card {
      margin-left: auto;
      margin-right: auto;
  }

  div.gameImage {
    margin-left: auto;
    margin-right: auto;
  }
</style>
</head>

<body>
<!-- Search box -->
  <form id="gameSearch">
    <input id="gameSearch" name="gameSearch" type="text">
    <button id = "gameButtonSearch">Get Games</button>
  </form>
<!-- This is just a div for games to populate for related games from cheapshark api -->
  <div id="gameData">
    <ul id="gameList">
    </ul>
  </div>
<!-- This is the card code I grabbed from Bootstrap -->
<div class="card" style="width: 25rem;">
  <div id = "gameImage"></div>
  <div id="card-body">
    <h5 id="gameName"></h5>
    <p id="gameDescription"></p>
  </div>
  <ul id="list-group list-group-flush">
    <li id="gameSite"></li>
    <li id="gameMeta"></li>
  </ul>
  <div id="card-body">
    <a href="#" id="card-link1"></a>
    <a href="#" id="card-link2"></a>
  </div>
</div>
 <script>
  const form = document.getElementById("gameSearch");
  const gameData = document.getElementById("gameData");
//CHEAPSHARK API - Search by Game Title and populate gameList <ul> with the game titles in <li>
    // form.addEventListener('submit', (event) => {
    //   event.preventDefault();
    //   console.log(event);
    //   const gameSearch = event.target.gameSearch.value;
    //   console.log(gameSearch);
    //   fetch(`https://www.cheapshark.com/api/1.0/games?title=${gameSearch}`)
    //     .then(res => res.json())
    //     .then(data => {
    //       console.log(data);
    //       for(i=0; i<data.length; i++){
    //         const gameListItem = document.createElement("li");
    //         const gameList = document.getElementById("gameList");
    //         gameList.appendChild(gameListItem);
    //         gameListItem.innerHTML = `
    //         ${data[i].external}
    //         `
    //       }
    //     });
    // });
   
//OPENCRITIC API - This one will only bring up game titles...
    // form.addEventListener('submit', (event) => {
    //   event.preventDefault();
    //   console.log(event);
    //   const gameSearch = event.target.gameSearch.value;
    //   const url = `https://opencritic-api.p.rapidapi.com/game/search?criteria=${gameSearch}`;
    //   const options = {
    // 	  method: 'GET',
    // 	  headers: {
    // 		  'X-RapidAPI-Key': '6acd22919fmsh67d97738d0c2b37p1c55b4jsnf3f6b669c6cd',
    // 		  'X-RapidAPI-Host': 'opencritic-api.p.rapidapi.com'
    // 	  }
    //   };

    // try {
    // 	const response = fetch(url, options)
    //   .then(res => res.json())
    //   .then(data => {
    //     console.log(data);
    //   }); 
    // }
    // catch (error) {
    // 	console.error(error);
    // }
    // });

//OPENCRITIC API - This one will tell you the 8 nearest upcoming games and the release dates on initial window load
    // window.addEventListener('load', (event) => {
    //   event.preventDefault();
    //   console.log(event);
    //   const url = `https://opencritic-api.p.rapidapi.com/game/upcoming`;
    //   const options = {
	  //     method: 'GET',
	  //     headers: {
		//       'X-RapidAPI-Key': '6acd22919fmsh67d97738d0c2b37p1c55b4jsnf3f6b669c6cd',
		//       'X-RapidAPI-Host': 'opencritic-api.p.rapidapi.com'
	  //     }
    //   };
    // try {
	  //   const response = fetch(url, options)
    //   .then(res => res.json())
    //   .then(data => {
    //     console.log("this is the data")
    //     console.log(data);
    //     for(i=0; i<data.length; i++){
    //       const gameListItem = document.createElement("li");
    //       const gameList = document.getElementById("gameList");
    //       gameList.appendChild(gameListItem);
    //       gameListItem.innerHTML = `${data[i].name}, is releasing on ${data[i].firstReleaseDate}`
    //       console.log("Looped")
    //     }
    //   });
    // }
    // catch (error) {
    //   console.log("this is the error")
	  //   console.error(error);
    // }
    // });


  //RAWG API -- OUR BEST BET SO FAR!!!
//   const rawgAPi = "ff0ae1ba7da843b6af414828bfa56f91"
//   form.addEventListener ('submit', (event) => {
//   event.preventDefault();
//   console.log(event);
//   const gameSearch = event.target.gameSearch.value;
//   //converts game search to slug
//   function slugify(str) {
//   return String(str)
//     .toLowerCase() // convert to lowercase
//     .replace(/\s+/g, '-') // replace spaces with hyphens
//   }
// //running into favicon.ico error
//   const gameSearchslug = (slugify(`${gameSearch}`))
//   fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${gameSearchslug}?key=${rawgAPi}&search_exact=false&search_precise=false`)
//     .then(res => res.json())
//     .then(data => {
// // Added code that would take the searched term and converted it to slug then to id.
//   const id = (`${data.slug}`)
//   fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${id}?key=${rawgAPi}`)
//     .then(res => res.json())
//     .then(data => {
//       console.log(data);
//       const gameName = document.getElementById("gameName")
//       const gameDescription = document.getElementById("gameDescription")
//       const image = document.getElementById("gameImage")
//       const gameSite = document.getElementById("gameSite")
//       const gameMeta = document.getElementById("gameMeta")
//       gameName.innerHTML = `${data.name} comes out on ${data.released}`
//       gameDescription.innerHTML = `${data.description}`
//       image.innerHTML = `<img src="${data.background_image}" width = "398" height = "150">`
//       gameSite.innerHTML = `<a href = "${data.website}">Click here to visit ${data.name}'s website!</a>`
//       gameMeta.innerHTML = `<a href = "${data.metacritic_url}">Click here to visit ${data.name}'s Metacritic page!</a>`
//     })
//     })
//   });

  
//STILL WORKING ON BELOW CODE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// //Gamespot API 42ca3a8ff2dc770f2e69d2367678840e5faef0ce  

  // const gameSpotAPI = "42ca3a8ff2dc770f2e69d2367678840e5faef0ce"
  // form.addEventListener('submit', (event) => {
  // event.preventDefault();
  // console.log(event);
  // const gameSearch = event.target.gameSearch.value;
  // const date = new Date();
  // let tmrwYear = date.getYear().toString().substr(-2);
  // let tmrwMonth = String(date.getMonth() + 1).padStart(2, "0");
  // let tmrwDay = date.getDate() + 1;
  // let tmrwDate = `${tmrwYear}${tmrwMonth}${tmrwDay}`
  // console.log(tmrwDate);
  // console.log(gameSearch);
  // //below fetch will use search box and pull all games matching that search query in data
  // //  fetch(`https://cors-proxy.fringe.zone/https://www.gamespot.com/api/games/?format=json&filter=name:${gameSearch}&api_key=${gameSpotAPI}`)
  // //below fetch will be able to find all games releasing from "tomorrow" until the forseeable future (July 1st 2033). Only one filter can be active in URL at a time? Maybe ask Juan. There's too many duplicates because we can't filter out by console, and there's a ton of junk on steam store. 
  //  fetch(`https://cors-proxy.fringe.zone/https://www.gamespot.com/api/releases/?format=json&filter=name:${gameSearch},release_date:${tmrwDate}|330701&api_key=${gameSpotAPI}`)
  //   .then(res => res.json())
  //   .then(data => {
  //     console.log(data);
  //     const gameName = document.getElementById("gameName")
  //     const gameDescription = document.getElementById("gameDescription")
  //     const image = document.getElementById("gameImage")
  //     const gameSite = document.getElementById("gameSite")
  //     const gameMeta = document.getElementById("gameMeta")
  //     gameName.innerHTML = `${data.name} comes out on ${data.released}`
  //     gameDescription.innerHTML = `${data.description}`
  //     image.innerHTML = `<img src="${data.background_image}" width = "398" height = "150">`
  //     gameSite.innerHTML = `<a href = "${data.website}">Click here to visit ${data.name}'s website!</a>`
  //     gameMeta.innerHTML = `<a href = "${data.metacritic_url}">Click here to visit ${data.name}'s Metacritic page!</a>`
  //   })
  //   })



//WORKING CODEvvv
form.addEventListener('submit', (event) => {
  event.preventDefault();
  const gameSpotAPI = "42ca3a8ff2dc770f2e69d2367678840e5faef0ce";
  const gameSearch = encodeURIComponent(event.target.gameSearch.value);
  const date = new Date();
  let tmrwYear = date.getYear().toString().substr(-2);
  let tmrwMonth = String(date.getMonth() + 1).padStart(2, "0");
  let tmrwDay = date.getDate() + 1;
  let tmrwDate = `${tmrwYear}${tmrwMonth}${tmrwDay}`;

  gameList.innerHTML = "";
  console.log(gameSearch);
  fetch(`https://cors-proxy.fringe.zone/https://www.gamespot.com/api/games/?format=json&filter=name:${gameSearch},release_date:${tmrwDate}|330701&api_key=${gameSpotAPI}`)
  .then(res => res.json())
  .then(data => {
    console.log(data);
    for(i=0; i<data.results.length; i++){
      const gameListItem = document.createElement("button");
      gameListItem.setAttribute('id', 'btnClass');
      // gameListItem.setAttribute('class', 'btnClass');

      const gameList = document.getElementById("gameList");
      gameList.appendChild(gameListItem);
      gameListItem.innerHTML = `
        ${data.results[i].name}
      `;
    };
  });
});
// const gameList = document.querySelectorAll("btnClass");
//NEED TO GET THE BELOW LINE TO WORK WITH btnClass!!! How to getElementById for unmade element?
const gameList = document.getElementById("gameList");
// gameList.onclick = function(){
  gameList.addEventListener('click', (event) => {
  const rawgAPi = "ff0ae1ba7da843b6af414828bfa56f91";
  event.preventDefault();
  console.log("function worked");
  gameSpecificSearch = gameList.innerText;
  console.log(gameSpecificSearch);
  function slugify(str){
    return String(str)
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/'/g, '')
  }
  
  let gameSpecificSearchslug = encodeURIComponent(slugify(`${gameSpecificSearch}`));
  console.log(gameSpecificSearchslug)
  fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${gameSpecificSearchslug}?key=${rawgAPi}&search_exact=false&search_precise=false`)
  .then(res => res.json())
  .then(data => {
    const id = (`${data.slug}`);
    console.log(data);
    fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${id}?key=${rawgAPi}`)
    .then(res => res.json())
    .then(data => {
      console.log(data)
      for(i=0; i<data.results.length; i++){
        const gameListItem = document.createElement("button");
        const gameList = document.getElementById("gameList");
        gameList.appendChild(gameListItem);
        gameListItem.innerHTML = `
          ${data.results[i].name}
          <img src="${data.results[i].image.original}" 
            onclick="location.href='./GameSearch.html?gameSearch=${data.results[i].name}';" width = "200" height = "150">
            TEST
            <div id="dataresult">${data.results[i].release_date}</div>

        `
      }
      // data.results.forEach((datum) => {
      //   const gameListItem = document.createElement("button");
      //   const gameList = document.getElementById("gameList");
      //   gameList.appendChild(gameListItem);
      //   gameListItem.innerHTML = `
      //     ${datum.name}
      //     <img src="${datum.image.original}" 
      //       onclick="location.href='./GameSearch.html?gameSearch=${datum.name}';" width = "200" height = "150">
      //       TEST
      //   `
      // })

    
//above transfers to .gameSearch.html
   });
  });
});
//WORKING CODE ^^^










//   const button = document.getElementsByTagName("button")
//   button.addEventListener('click', () =>{
//     event.preventDefault();
//     gameSearch = button.innerHTML
//      //converts game search to slug
//   function slugify(str) {
//   return String(str)
//     .toLowerCase() // convert to lowercase
//     .replace(/\s+/g, '-') // replace spaces with hyphens
//   }
// //running into favicon.ico error
//   const gameSearchslug = (slugify(`${gameSearch}`))
//   fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${gameSearchslug}?key=${rawgAPi}&search_exact=false&search_precise=false`)
//     .then(res => res.json())
//     .then(data => {
// // Added code that would take the searched term and converted it to slug then to id.
//   const id = (`${data.slug}`)
//   fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${id}?key=${rawgAPi}`)
//     .then(res => res.json())
//     .then(data => {
//       console.log(data);
//       const gameName = document.getElementById("gameName")
//       const gameDescription = document.getElementById("gameDescription")
//       const image = document.getElementById("gameImage")
//       const gameSite = document.getElementById("gameSite")
//       const gameMeta = document.getElementById("gameMeta")
//       gameName.innerHTML = `${data.name} comes out on ${data.released}`
//       gameDescription.innerHTML = `${data.description}`
//       image.innerHTML = `<img src="${data.background_image}" width = "398" height = "150">`
//       gameSite.innerHTML = `<a href = "${data.website}">Click here to visit ${data.name}'s website!</a>`
//       gameMeta.innerHTML = `<a href = "${data.metacritic_url}">Click here to visit ${data.name}'s Metacritic page!</a>`
//     })
//     });






   
  
        // const button2 = document.getElementsByTagName("button");
        // button2[0,1].addEventListener('click'), (e) => {
        // event.preventDefault();
        // alert("you clicked a button");
        // };
  // button2.addEventListener('click'), () => {
  //   alert("you clicked a button");
  
      //   const button2 = document.getElementsByTagName("button2");
      //   // document.getElementsByTagName("button2").setAttribute("name","button");
      //   button2.id="button2";
      //   button2.class="button2";
      // console.log (button2);
      // button2.addEventListener('click'), () => {
      //   alert("you clicked a button")
      // }
    //  btn[0].addEventListener('click', () => {
    // event.preventDefault();
    // })
    // gameSearch = button.innerHTML
     //converts game search to slug
//   function slugify(str) {
//   return String(str)
//     .toLowerCase() // convert to lowercase
//     .replace(/\s+/g, '-') // replace spaces with hyphens
//   }
// //running into favicon.ico error
//   const gameSearchslug = (slugify(`${gameSearch}`))
//   fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${gameSearchslug}?key=${rawgAPi}&search_exact=false&search_precise=false`)
//     .then(res => res.json())
//     .then(data => {
// // Added code that would take the searched term and converted it to slug then to id.
//   const id = (`${data.slug}`)
//   fetch(`https://cors-proxy.fringe.zone/https://api.rawg.io/api/games/${id}?key=${rawgAPi}`)
//     .then(res => res.json())
//     .then(data => {
//       console.log(data);
//       const gameName = document.getElementById("gameName")
//       const gameDescription = document.getElementById("gameDescription")
//       const image = document.getElementById("gameImage")
//       const gameSite = document.getElementById("gameSite")
//       const gameMeta = document.getElementById("gameMeta")
//       gameName.innerHTML = `${data.name} comes out on ${data.released}`
//       gameDescription.innerHTML = `${data.description}`
//       image.innerHTML = `<img src="${data.background_image}" width = "398" height = "150">`
//       gameSite.innerHTML = `<a href = "${data.website}">Click here to visit ${data.name}'s website!</a>`
//       gameMeta.innerHTML = `<a href = "${data.metacritic_url}">Click here to visit ${data.name}'s Metacritic page!</a>`
//     })
//     });

//   })
















  //Giantbomb API
  // const giantBombAPI = "4ccf8f3bad38d69d7a94f106fe749bdff1d91ef5"
  // form.addEventListener('submit', (event) => {
  // event.preventDefault();
  // const gameSearch = event.target.gameSearch.value;
  // const date = new Date();
  // let tmrwYear = date.getYear().toString().substr(-2);
  // let tmrwMonth = String(date.getMonth() + 1).padStart(2, "0");
  // let tmrwDay = date.getDate() + 1;
  // let tmrwDate = `${tmrwYear}${tmrwMonth}${tmrwDay}`
  // console.log(gameSearch);
  // //the below fetch needs to take in an ID instead of a search value. Need to figure out how to replace somehow if possible.
  // fetch(`https://cors-proxy.fringe.zone/https://www.giantbomb.com/api/games/?api_key=${giantBombAPI}`)
  
  // //the below fetch works the same way as the gamespot one will work for all game releases. Redundancy for now but maybe giantbomb can be more flexible
  // // fetch(`https://cors-proxy.fringe.zone/https://www.giantbomb.com/api/releases/?format=json&api_key=${giantBombAPI}`)
  //   .then(res => res.json())
  //   .then(data => {
  //     console.log(data);
  //     const gameName = document.getElementById("gameName")
  //     const gameDescription = document.getElementById("gameDescription")
  //     const image = document.getElementById("gameImage")
  //     const gameSite = document.getElementById("gameSite")
  //     const gameMeta = document.getElementById("gameMeta")
  //     gameName.innerHTML = `${data.name} comes out on ${data.released}`
  //     gameDescription.innerHTML = `${data.description}`
  //     image.innerHTML = `<img src="${data.background_image}" width = "398" height = "150">`
  //     gameSite.innerHTML = `<a href = "${data.website}">Click here to visit ${data.name}'s website!</a>`
  //     gameMeta.innerHTML = `<a href = "${data.metacritic_url}">Click here to visit ${data.name}'s Metacritic page!</a>`
  //   });
  // });

  </script>

</body>

</html>