<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GIANTBOMB VIDEO</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="shortcut icon" href="#">
<style>
  form {
      text-align:center;
  }

  div.card {
      margin-left: auto;
      margin-right: auto;
  }

  div.gameImage {
    margin-left: auto;
    margin-right: auto;
  }

</style>
</head>

<body>
<!-- Search box -->
  <form id="gameSearch">
    <input id="gameSearch" name="gameSearch" type="text">
    <button id = "gameButtonSearch" class="btn btn-secondary">Get Games</button>
  </form>

<!-- Main Game Card -->
<div class="card" style="width: 25rem;">
  <div id = "gameImage"></div>
  <div id="card-body">
  <h5 id="gameName"></h5>
  <p id="gameDescription"></p>
</div>
</div>
</br>
<!-- Video Columns -->
<div class="container text-center" display: none>
  <div class="row align-items-start">
    <div class="col">
      <iframe id="gameVid1" height="200" width="300"></iframe>
    </div>
    <div class="col">
      <iframe id="gameVid2" height="200" width="300"></iframe>
    </div>
    <div class="col">
      <iframe id="gameVid3" height="200" width="300"></iframe> 
    </div>
  </div>
</div>
 <script>

const form = document.getElementById("gameSearch");
const gameData = document.getElementById("gameData");

form.addEventListener('submit', async (event) => {
  event.preventDefault();
  const gameSearch = event.target.gameSearch.value;
  const giantBombAPI = "4ccf8f3bad38d69d7a94f106fe749bdff1d91ef5";
  const gameSpotAPI = "42ca3a8ff2dc770f2e69d2367678840e5faef0ce"
  const date = new Date();
  let tmrwYear = date.getYear().toString().substr(-2);
  let tmrwMonth = String(date.getMonth() + 1).padStart(2, "0");
  let tmrwDay = date.getDate() + 1;
  let tmrwDate = `${tmrwYear}${tmrwMonth}${tmrwDay}`;

  try {
    // Initial Giantbomb Search
    const giantBombResponse = await fetch(`https://cors-proxy.fringe.zone/https://www.giantbomb.com/api/games/?format=json&filter=name:${gameSearch},original_release_date:${tmrwDate}|20330701&api_key=${giantBombAPI}`);
    const giantBombData = await giantBombResponse.json();

    const gameName = document.getElementById("gameName");
    const gameDescription = document.getElementById("gameDescription");
    const image = document.getElementById("gameImage");
    const gameSite = document.getElementById("gameSite");
    const gameMeta = document.getElementById("gameMeta");
    const gameRelease = document.getElementById("gameRelease");

    if (giantBombData.number_of_total_results < Number(1)){
      image.innerHTML = `<img src="https://media.gettyimages.com/id/584562884/photo/marmot-at-hole-home.webp?s=2048x2048&w=gi&k=20&c=EuEu0WDG-fSYPfWUh2MlKKve1Eg9MdUmHSOniAGJfIk=" width="398" height="400">`;
      gameName.innerHTML = "Sorry, it looks like that game has already been released or may not have a release date yet";
      gameDescription.innerHTML = "";
      gameRelease.innerHTML = "";
    }
    
    else if (giantBombData.number_of_total_results >= Number (1)){
      giantBombData.results.map((datum) => {
        image.innerHTML = `<img src="${datum.image.small_url}" width="398" height="400">`;
        gameName.innerHTML = `${datum.name}`;
        gameDescription.innerHTML = `${datum.deck}`;
        gameRelease.innerHTML =  `Expected release date - ${datum.expected_release_month}-${datum.expected_release_day}-${datum.expected_release_year}`
      });
    }

    switch (giantBombData.number_of_total_results <= Number(1)) {
        case "[0,1]": {
        console.log("none");
        break;
        }
      }
    // Video fetch from Gamespot
    const gameSpotResponse = await fetch(`https://cors-proxy.fringe.zone/https://www.gamespot.com/api/videos/?format=json&filter=title:${gameSearch}&api_key=${gameSpotAPI}`);
    const gameSpotData = await gameSpotResponse.json();

    console.log(gameSpotData);
    let videoContainer1 = document.getElementById("gameVid1");
    let videoContainer2 = document.getElementById("gameVid2");
    let videoContainer3 = document.getElementById("gameVid3");
    let videoContainer4 = document.getElementById("gameVid4");
    videoContainer1.setAttribute("src", `${gameSpotData.results[0].low_url}`);
    videoContainer2.setAttribute("src", `${gameSpotData.results[1].low_url}`);
    videoContainer3.setAttribute("src", `${gameSpotData.results[2].low_url}`);
    videoContainer4.setAttribute("src", `${gameSpotData.results[3].low_url}`);
    videoContainer1.setAttribute("controls","true");
    videoContainer2.setAttribute("controls","true");
    videoContainer3.setAttribute("controls","true");
    videoContainer4.setAttribute("controls","true");
  }
  catch (error) {
    console.error('Error:', error);
  }
});

  </script>

</body>

</html>